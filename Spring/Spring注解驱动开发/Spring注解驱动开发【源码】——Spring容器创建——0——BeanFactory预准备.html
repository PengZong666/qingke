<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Spring注解驱动开发【源码】——Spring容器创建——0——BeanFactory预准备 | 青稞</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/favicon.ico">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <meta name="description" content="青稞博客">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    <meta name="author" content="pengbin">
    <meta name="keywords" content="青稞博客，pengbin，Java">
    
    <link rel="preload" href="/assets/css/0.styles.f429574a.css" as="style"><link rel="preload" href="/assets/js/app.ca4a5c76.js" as="script"><link rel="preload" href="/assets/js/7.68ce5028.js" as="script"><link rel="preload" href="/assets/js/2.70f78407.js" as="script"><link rel="preload" href="/assets/js/61.aa3314fc.js" as="script"><link rel="preload" href="/assets/js/3.53eca6bf.js" as="script"><link rel="prefetch" href="/assets/js/10.f8e3b834.js"><link rel="prefetch" href="/assets/js/11.cb7f5bfe.js"><link rel="prefetch" href="/assets/js/12.17c994e7.js"><link rel="prefetch" href="/assets/js/13.4f7fc9d1.js"><link rel="prefetch" href="/assets/js/14.a726da66.js"><link rel="prefetch" href="/assets/js/15.5e2b11c0.js"><link rel="prefetch" href="/assets/js/16.97b55fe1.js"><link rel="prefetch" href="/assets/js/17.03fa6923.js"><link rel="prefetch" href="/assets/js/18.76e0add0.js"><link rel="prefetch" href="/assets/js/19.fec758f5.js"><link rel="prefetch" href="/assets/js/20.821e2371.js"><link rel="prefetch" href="/assets/js/21.8d19e20e.js"><link rel="prefetch" href="/assets/js/22.0842ed24.js"><link rel="prefetch" href="/assets/js/23.29fd87d4.js"><link rel="prefetch" href="/assets/js/24.9f7994bb.js"><link rel="prefetch" href="/assets/js/25.d3ec7359.js"><link rel="prefetch" href="/assets/js/26.1d98f88e.js"><link rel="prefetch" href="/assets/js/27.3099fb26.js"><link rel="prefetch" href="/assets/js/28.4c6e1bec.js"><link rel="prefetch" href="/assets/js/29.fc29b477.js"><link rel="prefetch" href="/assets/js/30.6ac92f59.js"><link rel="prefetch" href="/assets/js/31.e7fb700e.js"><link rel="prefetch" href="/assets/js/32.0f569e44.js"><link rel="prefetch" href="/assets/js/33.a9283ff2.js"><link rel="prefetch" href="/assets/js/34.17741ef6.js"><link rel="prefetch" href="/assets/js/35.2b2fd760.js"><link rel="prefetch" href="/assets/js/36.92e6584a.js"><link rel="prefetch" href="/assets/js/37.23e6e91a.js"><link rel="prefetch" href="/assets/js/38.e5186903.js"><link rel="prefetch" href="/assets/js/39.9e822b97.js"><link rel="prefetch" href="/assets/js/4.35fd24d3.js"><link rel="prefetch" href="/assets/js/40.56dee8d9.js"><link rel="prefetch" href="/assets/js/41.1980e38d.js"><link rel="prefetch" href="/assets/js/42.35c73e47.js"><link rel="prefetch" href="/assets/js/43.ece5d3b7.js"><link rel="prefetch" href="/assets/js/44.f4475005.js"><link rel="prefetch" href="/assets/js/45.6aa9f077.js"><link rel="prefetch" href="/assets/js/46.101fdac6.js"><link rel="prefetch" href="/assets/js/47.6de1ccdb.js"><link rel="prefetch" href="/assets/js/48.089bb693.js"><link rel="prefetch" href="/assets/js/49.83f3535d.js"><link rel="prefetch" href="/assets/js/5.b7e699c0.js"><link rel="prefetch" href="/assets/js/50.3dfa1f86.js"><link rel="prefetch" href="/assets/js/51.86949e58.js"><link rel="prefetch" href="/assets/js/52.b6fafeea.js"><link rel="prefetch" href="/assets/js/53.c8759ff2.js"><link rel="prefetch" href="/assets/js/54.8c653e5a.js"><link rel="prefetch" href="/assets/js/55.55dda35b.js"><link rel="prefetch" href="/assets/js/56.7702a7fa.js"><link rel="prefetch" href="/assets/js/57.4294ace3.js"><link rel="prefetch" href="/assets/js/58.f9876d10.js"><link rel="prefetch" href="/assets/js/59.7723bd50.js"><link rel="prefetch" href="/assets/js/6.d6f9e6a3.js"><link rel="prefetch" href="/assets/js/60.5454dbcf.js"><link rel="prefetch" href="/assets/js/62.21b3c749.js"><link rel="prefetch" href="/assets/js/63.8bc62e61.js"><link rel="prefetch" href="/assets/js/64.9f03e7e8.js"><link rel="prefetch" href="/assets/js/65.c314b3ca.js"><link rel="prefetch" href="/assets/js/66.9a56faf3.js"><link rel="prefetch" href="/assets/js/67.28e604f0.js"><link rel="prefetch" href="/assets/js/68.dd8dca42.js"><link rel="prefetch" href="/assets/js/69.f972c80e.js"><link rel="prefetch" href="/assets/js/70.f3114344.js"><link rel="prefetch" href="/assets/js/71.7a2cd038.js"><link rel="prefetch" href="/assets/js/72.dc974191.js"><link rel="prefetch" href="/assets/js/73.eda16e6f.js"><link rel="prefetch" href="/assets/js/74.390e5c53.js"><link rel="prefetch" href="/assets/js/75.7074c4d0.js"><link rel="prefetch" href="/assets/js/76.07c0f165.js"><link rel="prefetch" href="/assets/js/77.e6296690.js"><link rel="prefetch" href="/assets/js/78.62d6c0b8.js"><link rel="prefetch" href="/assets/js/79.b2874ee3.js"><link rel="prefetch" href="/assets/js/8.9f2e2737.js"><link rel="prefetch" href="/assets/js/80.723778f0.js"><link rel="prefetch" href="/assets/js/81.b6a9ef2f.js"><link rel="prefetch" href="/assets/js/82.d1da3d88.js"><link rel="prefetch" href="/assets/js/83.feb7dc89.js"><link rel="prefetch" href="/assets/js/84.0115eb3c.js"><link rel="prefetch" href="/assets/js/9.105ffacc.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f429574a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/img/logo.jpg" alt="青稞" class="logo"> <span class="site-name can-hide">青稞</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java" class="mobile-dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Java/Java基础/" class="nav-link">
  Java基础
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="MySQL" class="dropdown-title"><span class="title">MySQL</span> <span class="arrow down"></span></button> <button type="button" aria-label="MySQL" class="mobile-dropdown-title"><span class="title">MySQL</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/MySQL/" class="nav-link">
  MySQL
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring" class="dropdown-title"><span class="title">Spring</span> <span class="arrow down"></span></button> <button type="button" aria-label="Spring" class="mobile-dropdown-title"><span class="title">Spring</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Spring/Spring入门/" class="nav-link">
  Spring入门
</a></li><li class="dropdown-item"><!----> <a href="/Spring/Spring注解驱动开发/" class="nav-link">
  Spring注解驱动开发
</a></li><li class="dropdown-item"><!----> <a href="/Spring/SpringMVC/" class="nav-link">
  Spring MVC
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/前端/CSS/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/前端/HTML/" class="nav-link">
  HTML
</a></li></ul></div></div><div class="nav-item"><a href="/about.html" class="nav-link">
  About
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java" class="mobile-dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Java/Java基础/" class="nav-link">
  Java基础
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="MySQL" class="dropdown-title"><span class="title">MySQL</span> <span class="arrow down"></span></button> <button type="button" aria-label="MySQL" class="mobile-dropdown-title"><span class="title">MySQL</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/MySQL/" class="nav-link">
  MySQL
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring" class="dropdown-title"><span class="title">Spring</span> <span class="arrow down"></span></button> <button type="button" aria-label="Spring" class="mobile-dropdown-title"><span class="title">Spring</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Spring/Spring入门/" class="nav-link">
  Spring入门
</a></li><li class="dropdown-item"><!----> <a href="/Spring/Spring注解驱动开发/" class="nav-link">
  Spring注解驱动开发
</a></li><li class="dropdown-item"><!----> <a href="/Spring/SpringMVC/" class="nav-link">
  Spring MVC
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/前端/CSS/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/前端/HTML/" class="nav-link">
  HTML
</a></li></ul></div></div><div class="nav-item"><a href="/about.html" class="nav-link">
  About
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Spring注解驱动开发</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Spring/Spring%E6%B3%A8%E8%A7%A3%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/" aria-current="page" class="sidebar-link">Spring注解驱动开发</a></li><li><a href="/Spring/Spring注解驱动开发/Spring注解驱动开发——-Profile实现多环境配置.html" class="sidebar-link">Spring注解驱动开发——@Profile实现多环境配置</a></li><li><a href="/Spring/Spring注解驱动开发/Spring注解驱动开发——AOP功能测试.html" class="sidebar-link">Spring注解驱动开发——AOP功能测试</a></li><li><a href="/Spring/Spring注解驱动开发/Spring注解驱动开发——属性赋值-自动装配.html" class="sidebar-link">Spring注解驱动开发——属性赋值&amp;自动装配</a></li><li><a href="/Spring/Spring注解驱动开发/Spring注解驱动开发——生命周期.html" class="sidebar-link">Spring注解驱动开发——生命周期</a></li><li><a href="/Spring/Spring注解驱动开发/Spring注解驱动开发——组件注册.html" class="sidebar-link">Spring注解驱动开发——组件注册</a></li><li><a href="/Spring/Spring注解驱动开发/Spring注解驱动开发【源码】——-EventListener-SmartInitializingSingleton.html" class="sidebar-link">Spring注解驱动开发【源码】——@EventListener&amp;SmartInitializingSingleton</a></li><li><a href="/Spring/Spring注解驱动开发/Spring注解驱动开发【源码】——AOP原理——-EnableAspectJAutoProxy.html" class="sidebar-link">Spring注解驱动开发【源码】——AOP原理——@EnableAspectJAutoProxy</a></li><li><a href="/Spring/Spring注解驱动开发/Spring注解驱动开发【源码】——AOP原理——AnnotationAwareAspectJAutoProxyCreator.html" class="sidebar-link">Spring注解驱动开发【源码】——AOP原理——AnnotationAwareAspectJAutoProxyCreator</a></li><li><a href="/Spring/Spring注解驱动开发/Spring注解驱动开发【源码】——AOP原理——创建AOP代理.html" class="sidebar-link">Spring注解驱动开发【源码】——AOP原理——创建AOP代理</a></li><li><a href="/Spring/Spring注解驱动开发/Spring注解驱动开发【源码】——AOP原理——获取拦截器链.html" class="sidebar-link">Spring注解驱动开发【源码】——AOP原理——获取拦截器链</a></li><li><a href="/Spring/Spring注解驱动开发/Spring注解驱动开发【源码】——AOP原理——链式调用通知方法.html" class="sidebar-link">Spring注解驱动开发【源码】——AOP原理——链式调用通知方法</a></li><li><a href="/Spring/Spring注解驱动开发/Spring注解驱动开发【源码】——AOP原理总结.html" class="sidebar-link">Spring注解驱动开发【源码】——AOP原理总结</a></li><li><a href="/Spring/Spring注解驱动开发/Spring注解驱动开发【源码】——ApplicationListener用法-原理.html" class="sidebar-link">Spring注解驱动开发【源码】——ApplicationListener用法&amp;原理</a></li><li><a href="/Spring/Spring注解驱动开发/Spring注解驱动开发【源码】——BeanDefinitionRegistryPostProcessor.html" class="sidebar-link">Spring注解驱动开发【源码】——BeanDefinitionRegistryPostProcessor</a></li><li><a href="/Spring/Spring注解驱动开发/Spring注解驱动开发【源码】——BeanFactoryPostProcessor.html" class="sidebar-link">Spring注解驱动开发【源码】——BeanFactoryPostProcessor</a></li><li><a href="/Spring/Spring注解驱动开发/Spring注解驱动开发【源码】——Spring容器创建——0——BeanFactory预准备.html" class="active sidebar-link">Spring注解驱动开发【源码】——Spring容器创建——0——BeanFactory预准备</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Spring/Spring注解驱动开发/Spring注解驱动开发【源码】——Spring容器创建——0——BeanFactory预准备.html#_1、preparerefresh-刷新前的预处理" class="sidebar-link">1、prepareRefresh(); 刷新前的预处理</a></li><li class="sidebar-sub-header"><a href="/Spring/Spring注解驱动开发/Spring注解驱动开发【源码】——Spring容器创建——0——BeanFactory预准备.html#_2、configurablelistablebeanfactory-beanfactory-obtainfreshbeanfactory-获取beanfactory" class="sidebar-link">2、ConfigurableListableBeanFactory beanFactory = obtainFreshBeanFactory(); 获取BeanFactory</a></li><li class="sidebar-sub-header"><a href="/Spring/Spring注解驱动开发/Spring注解驱动开发【源码】——Spring容器创建——0——BeanFactory预准备.html#_3、preparebeanfactory-beanfactory-beanfactory的预准备工作-对beanfactory进行一些设置" class="sidebar-link">3、prepareBeanFactory(beanFactory); BeanFactory的预准备工作（对BeanFactory进行一些设置）</a></li><li class="sidebar-sub-header"><a href="/Spring/Spring注解驱动开发/Spring注解驱动开发【源码】——Spring容器创建——0——BeanFactory预准备.html#_4、postprocessbeanfactory-beanfactory-beanfactory准备工作完成后进行的后置处理工作" class="sidebar-link">4、postProcessBeanFactory(beanFactory); BeanFactory准备工作完成后进行的后置处理工作</a></li></ul></li><li><a href="/Spring/Spring注解驱动开发/Spring注解驱动开发【源码】——Spring容器创建——1——执行BeanFactoryPostProcessor.html" class="sidebar-link">Spring注解驱动开发【源码】——Spring容器创建——1——执行BeanFactoryPostProcessor</a></li><li><a href="/Spring/Spring注解驱动开发/Spring注解驱动开发【源码】——Spring容器创建——2——注册BeanPostProcessors.html" class="sidebar-link">Spring注解驱动开发【源码】——Spring容器创建——2——注册BeanPostProcessors</a></li><li><a href="/Spring/Spring注解驱动开发/Spring注解驱动开发【源码】——Spring容器创建——3——执行MessageSource.html" class="sidebar-link">Spring注解驱动开发【源码】——Spring容器创建——3——执行MessageSource</a></li><li><a href="/Spring/Spring注解驱动开发/Spring注解驱动开发【源码】——Spring容器创建——4——初始化事件派发器、监听器等.html" class="sidebar-link">Spring注解驱动开发【源码】——Spring容器创建——4——初始化事件派发器、监听器等</a></li><li><a href="/Spring/Spring注解驱动开发/Spring注解驱动开发【源码】——Spring容器创建——5——创建Bean准备.html" class="sidebar-link">Spring注解驱动开发【源码】——Spring容器创建——5——创建Bean准备</a></li><li><a href="/Spring/Spring注解驱动开发/Spring注解驱动开发【源码】——Spring容器创建——6——Bean创建完成.html" class="sidebar-link">Spring注解驱动开发【源码】——Spring容器创建——6——Bean创建完成</a></li><li><a href="/Spring/Spring注解驱动开发/Spring注解驱动开发【源码】——Spring容器创建——7——容器创建完成.html" class="sidebar-link">Spring注解驱动开发【源码】——Spring容器创建——7——容器创建完成</a></li><li><a href="/Spring/Spring注解驱动开发/Spring注解驱动开发【源码】——Spring源码总结.html" class="sidebar-link">Spring注解驱动开发【源码】——Spring源码总结</a></li><li><a href="/Spring/Spring注解驱动开发/Spring注解驱动开发【源码】——声明式事务.html" class="sidebar-link">Spring注解驱动开发【源码】——声明式事务</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="研究refresh-创建刷新-方法"><a href="#研究refresh-创建刷新-方法" class="header-anchor">#</a> 研究refresh(创建刷新)方法</h1> <h2 id="_1、preparerefresh-刷新前的预处理"><a href="#_1、preparerefresh-刷新前的预处理" class="header-anchor">#</a> 1、prepareRefresh(); 刷新前的预处理</h2> <p><img src="https://gitee.com/pengzong888/imageSource/raw/master/img/2022/2/image-20220219175310600.png" alt="image-20220219175310600"></p> <blockquote><p>1、initPropertySources(); 初始化一些属性设置，子类自定义个性化的属性设置方法</p> <p>2、getEnvironment().validateRequiredProperties(); 校验属性的合法等</p> <p>3、this.earlyApplicationEvents = new LinkedHashSet<ApplicationEvent>(); 保存容器中的一些早期的事件</ApplicationEvent></p></blockquote> <h2 id="_2、configurablelistablebeanfactory-beanfactory-obtainfreshbeanfactory-获取beanfactory"><a href="#_2、configurablelistablebeanfactory-beanfactory-obtainfreshbeanfactory-获取beanfactory" class="header-anchor">#</a> 2、ConfigurableListableBeanFactory beanFactory = obtainFreshBeanFactory(); 获取BeanFactory</h2> <p><img src="https://gitee.com/pengzong888/imageSource/raw/master/img/2022/2/image-20220219175551019.png" alt="image-20220219175551019"></p> <blockquote><p>1、refreshBeanFactory(); 刷新【创建】BeanFactory</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">refreshBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IllegalStateException</span> <span class="token punctuation">{</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>refreshed<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span>
            <span class="token string">&quot;GenericApplicationContext does not support multiple refresh attempts: just call 'refresh' once&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>beanFactory<span class="token punctuation">.</span><span class="token function">setSerializationId</span><span class="token punctuation">(</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>​    创建一个 this.beanFactory = new DefaultListableBeanFactory(); 设置id</p> <p>2、ConfigurableListableBeanFactory beanFactory = getBeanFactory();</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">ConfigurableListableBeanFactory</span> <span class="token function">getBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 返回GenericApplicationContext刚才创建的BeanFactory</span>
   	<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>beanFactory<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>3、return beanFactory; 将创建好的BeanFactory【DefaultListableBeanFactory】返回</p></blockquote> <h2 id="_3、preparebeanfactory-beanfactory-beanfactory的预准备工作-对beanfactory进行一些设置"><a href="#_3、preparebeanfactory-beanfactory-beanfactory的预准备工作-对beanfactory进行一些设置" class="header-anchor">#</a> 3、prepareBeanFactory(beanFactory); BeanFactory的预准备工作（对BeanFactory进行一些设置）</h2> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">prepareBeanFactory</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableListableBeanFactory</span> beanFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1、设置BeanFactory的类加载器、支持表达式解析器......</span>
    <span class="token comment">// Tell the internal bean factory to use the context's class loader etc.</span>
    beanFactory<span class="token punctuation">.</span><span class="token function">setBeanClassLoader</span><span class="token punctuation">(</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    beanFactory<span class="token punctuation">.</span><span class="token function">setBeanExpressionResolver</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StandardBeanExpressionResolver</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">.</span><span class="token function">getBeanClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    beanFactory<span class="token punctuation">.</span><span class="token function">addPropertyEditorRegistrar</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ResourceEditorRegistrar</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token function">getEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 2、添加部分BeanPostProcessor【ApplicationContextAwareProcessor】</span>
    <span class="token comment">// Configure the bean factory with context callbacks.</span>
    beanFactory<span class="token punctuation">.</span><span class="token function">addBeanPostProcessor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ApplicationContextAwareProcessor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 3、设置忽略的自动装配的接口【EnvironmentAware、EmbeddedValueResolverAware、......】</span>
    beanFactory<span class="token punctuation">.</span><span class="token function">ignoreDependencyInterface</span><span class="token punctuation">(</span><span class="token class-name">EnvironmentAware</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    beanFactory<span class="token punctuation">.</span><span class="token function">ignoreDependencyInterface</span><span class="token punctuation">(</span><span class="token class-name">EmbeddedValueResolverAware</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    beanFactory<span class="token punctuation">.</span><span class="token function">ignoreDependencyInterface</span><span class="token punctuation">(</span><span class="token class-name">ResourceLoaderAware</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    beanFactory<span class="token punctuation">.</span><span class="token function">ignoreDependencyInterface</span><span class="token punctuation">(</span><span class="token class-name">ApplicationEventPublisherAware</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    beanFactory<span class="token punctuation">.</span><span class="token function">ignoreDependencyInterface</span><span class="token punctuation">(</span><span class="token class-name">MessageSourceAware</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    beanFactory<span class="token punctuation">.</span><span class="token function">ignoreDependencyInterface</span><span class="token punctuation">(</span><span class="token class-name">ApplicationContextAware</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 4、注册可以解析的自动装配，我们能够在任何组件中自动注入：BeanFactory、ResourceLoader、ApplicationEventPublisher、ApplicationContext</span>
    <span class="token comment">// BeanFactory interface not registered as resolvable type in a plain factory.</span>
    <span class="token comment">// MessageSource registered (and found for autowiring) as a bean.</span>
    beanFactory<span class="token punctuation">.</span><span class="token function">registerResolvableDependency</span><span class="token punctuation">(</span><span class="token class-name">BeanFactory</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> beanFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
    beanFactory<span class="token punctuation">.</span><span class="token function">registerResolvableDependency</span><span class="token punctuation">(</span><span class="token class-name">ResourceLoader</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    beanFactory<span class="token punctuation">.</span><span class="token function">registerResolvableDependency</span><span class="token punctuation">(</span><span class="token class-name">ApplicationEventPublisher</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    beanFactory<span class="token punctuation">.</span><span class="token function">registerResolvableDependency</span><span class="token punctuation">(</span><span class="token class-name">ApplicationContext</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 5、添加BeanPostProcessor【ApplicationListenerDetector】</span>
    <span class="token comment">// Register early post-processor for detecting inner beans as ApplicationListeners.</span>
    beanFactory<span class="token punctuation">.</span><span class="token function">addBeanPostProcessor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ApplicationListenerDetector</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 6、添加编译时的AspectJ</span>
    <span class="token comment">// Detect a LoadTimeWeaver and prepare for weaving, if found.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>beanFactory<span class="token punctuation">.</span><span class="token function">containsBean</span><span class="token punctuation">(</span><span class="token constant">LOAD_TIME_WEAVER_BEAN_NAME</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        beanFactory<span class="token punctuation">.</span><span class="token function">addBeanPostProcessor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LoadTimeWeaverAwareProcessor</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Set a temporary ClassLoader for type matching.</span>
        beanFactory<span class="token punctuation">.</span><span class="token function">setTempClassLoader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ContextTypeMatchClassLoader</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">.</span><span class="token function">getBeanClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 7、给BeanFactory中注册一些能用的组件 environment【ConfigurableEnvironment】、systemProperties【Map&lt;String, Object&gt;】、systemEnvironment【Map&lt;String, Object&gt;】</span>
    <span class="token comment">// Register default environment beans.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>beanFactory<span class="token punctuation">.</span><span class="token function">containsLocalBean</span><span class="token punctuation">(</span><span class="token constant">ENVIRONMENT_BEAN_NAME</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        beanFactory<span class="token punctuation">.</span><span class="token function">registerSingleton</span><span class="token punctuation">(</span><span class="token constant">ENVIRONMENT_BEAN_NAME</span><span class="token punctuation">,</span> <span class="token function">getEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>beanFactory<span class="token punctuation">.</span><span class="token function">containsLocalBean</span><span class="token punctuation">(</span><span class="token constant">SYSTEM_PROPERTIES_BEAN_NAME</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        beanFactory<span class="token punctuation">.</span><span class="token function">registerSingleton</span><span class="token punctuation">(</span><span class="token constant">SYSTEM_PROPERTIES_BEAN_NAME</span><span class="token punctuation">,</span> <span class="token function">getEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSystemProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>beanFactory<span class="token punctuation">.</span><span class="token function">containsLocalBean</span><span class="token punctuation">(</span><span class="token constant">SYSTEM_ENVIRONMENT_BEAN_NAME</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        beanFactory<span class="token punctuation">.</span><span class="token function">registerSingleton</span><span class="token punctuation">(</span><span class="token constant">SYSTEM_ENVIRONMENT_BEAN_NAME</span><span class="token punctuation">,</span> <span class="token function">getEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSystemEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_4、postprocessbeanfactory-beanfactory-beanfactory准备工作完成后进行的后置处理工作"><a href="#_4、postprocessbeanfactory-beanfactory-beanfactory准备工作完成后进行的后置处理工作" class="header-anchor">#</a> 4、postProcessBeanFactory(beanFactory); BeanFactory准备工作完成后进行的后置处理工作</h2> <p><strong>空方法</strong></p> <p>1、子类通过重写这个方法来在BeanFactory创建并预准备完成以后做进一步设置</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Spring/Spring注解驱动开发/Spring注解驱动开发【源码】——BeanFactoryPostProcessor.html" class="prev">
        Spring注解驱动开发【源码】——BeanFactoryPostProcessor
      </a></span> <span class="next"><a href="/Spring/Spring注解驱动开发/Spring注解驱动开发【源码】——Spring容器创建——1——执行BeanFactoryPostProcessor.html">
        Spring注解驱动开发【源码】——Spring容器创建——1——执行BeanFactoryPostProcessor
      </a>
      →
    </span></p></div>  <!----></main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.ca4a5c76.js" defer></script><script src="/assets/js/7.68ce5028.js" defer></script><script src="/assets/js/2.70f78407.js" defer></script><script src="/assets/js/61.aa3314fc.js" defer></script><script src="/assets/js/3.53eca6bf.js" defer></script>
  </body>
</html>
